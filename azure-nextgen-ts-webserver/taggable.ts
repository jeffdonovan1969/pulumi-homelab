import * as pulumi from "@pulumi/pulumi";

/**
 * registerAutoTags registers a global stack transformation that merges a set
 * of tags with whatever was also explicitly added to the resource definition.
 */
export function tagAllResources(autoTags: Record<string, string>): void {
    pulumi.runtime.registerStackTransformation((args) => {
        if (isTaggable(args.type)) {
            // Merge current tags with provided tags
            args.props["tags"] = {
                Name: args.name, // set a tag, but allow overrides on the resource itself
                ...args.props["tags"],
                ...autoTags,
            };
            return { props: args.props, opts: args.opts };
        }
        return undefined;
    });
}

/**
 * isTaggable returns true if the given resource type is an AWS resource that supports tags.
 */
export function isTaggable(t: string): boolean {
    return (taggableResourceTypes.indexOf(t) !== -1);
}

// taggableResourceTypes is a list of known Azure Next Gen type tokens that are taggable.
const taggableResourceTypes = [
    "azure-nextgen:agfoodplatform/latest:farmBeat",
    "azure-nextgen:alertsmanagement/latest:actionRule",
    "azure-nextgen:alertsmanagement/latest:smartDetectorAlertRule",
    "azure-nextgen:analysisservices/latest:server",
    "azure-nextgen:apimanagement/latest:servic",
    "azure-nextgen:appconfiguration/latest:configurationStore",
    "azure-nextgen:appplatform/latest:Sprin",
    "azure-nextgen:attestation/latest:attestationProvider",
    "azure-nextgen:authorization/latest:resourceManagementPrivateLink",
    "azure-nextgen:automanage/latest:account",
    "azure-nextgen:automanage/latest:configurationProfilePreference",
    "azure-nextgen:automation/latest:automationAccount",
    "azure-nextgen:automation/latest:configuration",
    "azure-nextgen:automation/latest:runbook",
    "azure-nextgen:avs/latest:privateCloud",
    "azure-nextgen:azureactivedirectory/latest:b2cDirectorie",
    "azure-nextgen:azureactivedirectory/latest:guestUsage",
    "azure-nextgen:azuredata/latest:dataController",
    "azure-nextgen:azuredata/latest:postgresInstance",
    "azure-nextgen:azuredata/latest:sqlManagedInstance",
    "azure-nextgen:azuredata/latest:sqlServerInstance",
    "azure-nextgen:azuredata/latest:sqlServerRegistration",
    "azure-nextgen:azurestack/latest:edgeSubscription",
    "azure-nextgen:azurestack/latest:linkedSubscription",
    "azure-nextgen:azurestack/latest:registration",
    "azure-nextgen:azurestackhci/latest:cluster",
    "azure-nextgen:batch/latest:batchAccount",
    "azure-nextgen:bingmaps/latest:mapApi",
    "azure-nextgen:blockchain/latest:blockchainMember",
    "azure-nextgen:blockchain/latest:cordaMember",
    "azure-nextgen:blockchain/latest:watcher",
    "azure-nextgen:blockchaintokens/latest:TokenService",
    "azure-nextgen:botservice/latest:botService",
    "azure-nextgen:cache/latest:Redi",
    "azure-nextgen:cache/latest:redisEnterpris",
    "azure-nextgen:cdn/latest:CdnWebApplicationFirewallPolicie",
    "azure-nextgen:cdn/latest:profile",
    "azure-nextgen:cdn/latest:endpoint",
    "azure-nextgen:certificateregistration/latest:certificateOrder",
    "azure-nextgen:codespaces/latest:plan",
    "azure-nextgen:cognitiveservices/latest:account",
    "azure-nextgen:compute/latest:availabilitySet",
    "azure-nextgen:compute/latest:cloudService",
    "azure-nextgen:compute/latest:diskAccesse",
    "azure-nextgen:compute/latest:diskEncryptionSet",
    "azure-nextgen:compute/latest:disk",
    "azure-nextgen:compute/latest:gallerie",
    "azure-nextgen:compute/latest:hostGroup",
    "azure-nextgen:compute/latest:host",
    "azure-nextgen:compute/latest:image",
    "azure-nextgen:compute/latest:proximityPlacementGroup",
    "azure-nextgen:compute/latest:restorePointCollection",
    "azure-nextgen:compute/latest:sharedVMExtension",
    "azure-nextgen:compute/latest:sharedVMImage",
    "azure-nextgen:compute/latest:snapshot",
    "azure-nextgen:compute/latest:sshPublicKey",
    "azure-nextgen:compute/latest:VirtualMachine",
    "azure-nextgen:compute/latest:extension",
    "azure-nextgen:compute/latest:runCommand",
    "azure-nextgen:compute/latest:virtualMachineScaleSet",
    "azure-nextgen:connectedcache/latest:CacheNode",
    "azure-nextgen:containerinstance/latest:containerGroup",
    "azure-nextgen:containerregistry/latest:registrie",
    "azure-nextgen:containerregistry/latest:agentPool",
    "azure-nextgen:containerregistry/latest:buildTask",
    "azure-nextgen:containerregistry/latest:replication",
    "azure-nextgen:containerregistry/latest:task",
    "azure-nextgen:containerregistry/latest:webhook",
    "azure-nextgen:containerservice/latest:containerService",
    "azure-nextgen:containerservice/latest:managedCluster",
    "azure-nextgen:containerservice/latest:openShiftManagedCluster",
    "azure-nextgen:costmanagement/latest:Connector",
    "azure-nextgen:customproviders/latest:resourceProvider",
    "azure-nextgen:d365customerinsights/latest:instance",
    "azure-nextgen:databox/latest:job",
    "azure-nextgen:databoxedge/latest:DataBoxEdgeDevice",
    "azure-nextgen:databricks/latest:workspace",
    "azure-nextgen:datacatalog/latest:catalog",
    "azure-nextgen:datafactory/latest:dataFactorie",
    "azure-nextgen:datafactory/latest:factorie",
    "azure-nextgen:datalakeanalytics/latest:account",
    "azure-nextgen:datalakestore/latest:account",
    "azure-nextgen:dataprotection/latest:BackupVault",
    "azure-nextgen:dataprotection/latest:ResourceOperationGateKeeper",
    "azure-nextgen:datashare/latest:account",
    "azure-nextgen:dbformariadb/latest:server",
    "azure-nextgen:dbformysql/latest:flexibleServer",
    "azure-nextgen:dbformysql/latest:server",
    "azure-nextgen:dbforpostgresql/latest:flexibleServer",
    "azure-nextgen:dbforpostgresql/latest:serverGroup",
    "azure-nextgen:dbforpostgresql/latest:server",
    "azure-nextgen:dbforpostgresql/latest:serversv",
    "azure-nextgen:deploymentmanager/latest:artifactSource",
    "azure-nextgen:deploymentmanager/latest:rollout",
    "azure-nextgen:deploymentmanager/latest:serviceTopologie",
    "azure-nextgen:deploymentmanager/latest:service",
    "azure-nextgen:deploymentmanager/latest:serviceUnit",
    "azure-nextgen:deploymentmanager/latest:step",
    "azure-nextgen:desktopvirtualization/latest:applicationgroup",
    "azure-nextgen:desktopvirtualization/latest:hostpool",
    "azure-nextgen:desktopvirtualization/latest:workspace",
    "azure-nextgen:devices/latest:ElasticPool",
    "azure-nextgen:devices/latest:IotHubTenant",
    "azure-nextgen:devices/latest:IotHub",
    "azure-nextgen:devices/latest:ProvisioningService",
    "azure-nextgen:deviceupdate/latest:account",
    "azure-nextgen:deviceupdate/latest:accounts/instance",
    "azure-nextgen:devops/latest:pipeline",
    "azure-nextgen:devspaces/latest:controller",
    "azure-nextgen:devtestlab/latest:labcenter",
    "azure-nextgen:devtestlab/latest:lab",
    "azure-nextgen:devtestlab/latest:environment",
    "azure-nextgen:devtestlab/latest:serviceRunner",
    "azure-nextgen:devtestlab/latest:VirtualMachine",
    "azure-nextgen:devtestlab/latest:schedule",
    "azure-nextgen:digitaltwins/latest:digitalTwinsInstance",
    "azure-nextgen:documentdb/latest:databaseAccount",
    "azure-nextgen:domainregistration/latest:domain",
    "azure-nextgen:enterpriseknowledgegraph/latest:service",
    "azure-nextgen:eventgrid/latest:domain",
    "azure-nextgen:eventgrid/latest:partnerNamespace",
    "azure-nextgen:eventgrid/latest:partnerRegistration",
    "azure-nextgen:eventgrid/latest:partnerTopic",
    "azure-nextgen:eventgrid/latest:systemTopic",
    "azure-nextgen:eventgrid/latest:topic",
    "azure-nextgen:eventhub/latest:cluster",
    "azure-nextgen:eventhub/latest:namespace",
    "azure-nextgen:experimentation/latest:experimentWorkspace",
    "azure-nextgen:falcon/latest:namespace",
    "azure-nextgen:genomics/latest:account",
    "azure-nextgen:guestconfiguration/latest:autoManagedAccount",
    "azure-nextgen:guestconfiguration/latest:autoManagedVmConfigurationProfile",
    "azure-nextgen:hanaonazure/latest:hanaInstance",
    "azure-nextgen:hanaonazure/latest:sapMonitor",
    "azure-nextgen:hardwaresecuritymodules/latest:dedicatedHSM",
    "azure-nextgen:hdinsight/latest:cluster",
    "azure-nextgen:healthcareapis/latest:service",
    "azure-nextgen:hybridcompute/latest:machine",
    "azure-nextgen:hybridcompute/latest:machines/extension",
    "azure-nextgen:hybriddata/latest:dataManager",
    "azure-nextgen:hybridnetwork/latest:device",
    "azure-nextgen:hybridnetwork/latest:virtualnetworkfunction",
    "azure-nextgen:hydra/latest:component",
    "azure-nextgen:hydra/latest:networkScope",
    "azure-nextgen:importexport/latest:job",
    "azure-nextgen:insights/latest:actionGroup",
    "azure-nextgen:insights/latest:activityLogAlert",
    "azure-nextgen:insights/latest:alertrule",
    "azure-nextgen:insights/latest:autoscalesetting",
    "azure-nextgen:insights/latest:component",
    "azure-nextgen:insights/latest:guestDiagnosticSetting",
    "azure-nextgen:insights/latest:guestDiagnosticSettingsAssociatio",
    "azure-nextgen:insights/latest:logprofile",
    "azure-nextgen:insights/latest:metricAlert",
    "azure-nextgen:insights/latest:privateLinkScope",
    "azure-nextgen:insights/latest:queryPack",
    "azure-nextgen:insights/latest:scheduledQueryRule",
    "azure-nextgen:insights/latest:webtest",
    "azure-nextgen:insights/latest:workbook",
    "azure-nextgen:insights/latest:workbooktemplate",
    "azure-nextgen:iotcentral/latest:IoTApp",
    "azure-nextgen:iotspaces/latest:Grap",
    "azure-nextgen:keyvault/latest:hsmPool",
    "azure-nextgen:keyvault/latest:managedHSM",
    "azure-nextgen:keyvault/latest:vault",
    "azure-nextgen:kubernetes/latest:connectedCluster",
    "azure-nextgen:kusto/latest:cluster",
    "azure-nextgen:labservices/latest:labaccount",
    "azure-nextgen:logic/latest:hostingEnvironment",
    "azure-nextgen:logic/latest:integrationAccount",
    "azure-nextgen:logic/latest:integrationServiceEnvironment",
    "azure-nextgen:logic/latest:isolatedEnvironment",
    "azure-nextgen:logic/latest:workflow",
    "azure-nextgen:machinelearning/latest:commitmentPlan",
    "azure-nextgen:machinelearning/latest:webService",
    "azure-nextgen:machinelearning/latest:Workspace",
    "azure-nextgen:machinelearningservices/latest:workspace",
    "azure-nextgen:machinelearningservices/latest:inferenceEndpoint",
    "azure-nextgen:machinelearningservices/latest:deployment",
    "azure-nextgen:maintenance/latest:maintenanceConfiguration",
    "azure-nextgen:managedidentity/latest:userAssignedIdentitie",
    "azure-nextgen:managednetwork/latest:managedNetwork",
    "azure-nextgen:managednetwork/latest:managedNetworkGroup",
    "azure-nextgen:managednetwork/latest:managedNetworkPeeringPolicie",
    "azure-nextgen:managednetwork/latest:notificatio",
    "azure-nextgen:maps/latest:account",
    "azure-nextgen:maps/latest:privateAtlase",
    "azure-nextgen:marketplaceapps/latest:classicDevService",
    "azure-nextgen:media/latest:mediaservice",
    "azure-nextgen:media/latest:liveEvent",
    "azure-nextgen:media/latest:streamingEndpoint",
    "azure-nextgen:microservices4spring/latest:appCluster",
    "azure-nextgen:migrate/latest:assessmentProject",
    "azure-nextgen:migrate/latest:migrateproject",
    "azure-nextgen:migrate/latest:moveCollection",
    "azure-nextgen:migrate/latest:project",
    "azure-nextgen:mixedreality/latest:holographicsBroadcastAccount",
    "azure-nextgen:mixedreality/latest:objectUnderstandingAccount",
    "azure-nextgen:mixedreality/latest:remoteRenderingAccount",
    "azure-nextgen:mixedreality/latest:spatialAnchorsAccount",
    "azure-nextgen:netapp/latest:netAppAccount",
    "azure-nextgen:netapp/latest:Pool",
    "azure-nextgen:netapp/latest:volume",
    "azure-nextgen:network/latest:applicationGateway",
    "azure-nextgen:network/latest:applicationGatewayWebApplicationFirewallPolicie",
    "azure-nextgen:network/latest:applicationSecurityGroup",
    "azure-nextgen:network/latest:azureFirewall",
    "azure-nextgen:network/latest:bastionHost",
    "azure-nextgen:network/latest:connection",
    "azure-nextgen:network/latest:ddosCustomPolicie",
    "azure-nextgen:network/latest:ddosProtectionPlan",
    "azure-nextgen:network/latest:dnszone",
    "azure-nextgen:network/latest:expressRouteCircuit",
    "azure-nextgen:network/latest:expressRouteCrossConnection",
    "azure-nextgen:network/latest:expressRouteGateway",
    "azure-nextgen:network/latest:expressRoutePort",
    "azure-nextgen:network/latest:firewallPolicie",
    "azure-nextgen:network/latest:frontdoor",
    "azure-nextgen:network/latest:frontdoorWebApplicationFirewallManagedRuleSet",
    "azure-nextgen:network/latest:frontdoorWebApplicationFirewallPolicie",
    "azure-nextgen:network/latest:ipGroup",
    "azure-nextgen:network/latest:loadBalancer",
    "azure-nextgen:network/latest:localNetworkGateway",
    "azure-nextgen:network/latest:natGateway",
    "azure-nextgen:network/latest:networkIntentPolicie",
    "azure-nextgen:network/latest:networkInterface",
    "azure-nextgen:network/latest:networkProfile",
    "azure-nextgen:network/latest:networkSecurityGroup",
    "azure-nextgen:network/latest:networkWatcher",
    "azure-nextgen:network/latest:connectionMonitor",
    "azure-nextgen:network/latest:lense",
    "azure-nextgen:network/latest:pingMeshe",
    "azure-nextgen:network/latest:p2sVpnGateway",
    "azure-nextgen:network/latest:privateDnsZone",
    "azure-nextgen:network/latest:virtualNetworkLink",
    "azure-nextgen:network/latest:privateEndpoint",
    "azure-nextgen:network/latest:privateLinkService",
    "azure-nextgen:network/latest:publicIPAddresse",
    "azure-nextgen:network/latest:publicIPPrefixe",
    "azure-nextgen:network/latest:routeFilter",
    "azure-nextgen:network/latest:routeTable",
    "azure-nextgen:network/latest:serviceEndpointPolicie",
    "azure-nextgen:network/latest:trafficmanagerprofile",
    "azure-nextgen:network/latest:virtualHub",
    "azure-nextgen:network/latest:virtualNetworkGateway",
    "azure-nextgen:network/latest:virtualNetwork",
    "azure-nextgen:network/latest:virtualNetworkTap",
    "azure-nextgen:network/latest:virtualWan",
    "azure-nextgen:network/latest:vpnGateway",
    "azure-nextgen:network/latest:vpnSite",
    "azure-nextgen:network/latest:webApplicationFirewallPolicie",
    "azure-nextgen:notificationhubs/latest:namespace",
    "azure-nextgen:notificationhubs/latest:notificationHub",
    "azure-nextgen:objectstore/latest:osNamespace",
    "azure-nextgen:offazure/latest:HyperVSite",
    "azure-nextgen:offazure/latest:ImportSite",
    "azure-nextgen:offazure/latest:MasterSite",
    "azure-nextgen:offazure/latest:ServerSite",
    "azure-nextgen:offazure/latest:VMwareSite",
    "azure-nextgen:operationalinsights/latest:cluster",
    "azure-nextgen:operationalinsights/latest:workspace",
    "azure-nextgen:operationsmanagement/latest:managementconfiguration",
    "azure-nextgen:operationsmanagement/latest:solution",
    "azure-nextgen:operationsmanagement/latest:view",
    "azure-nextgen:peering/latest:peering",
    "azure-nextgen:peering/latest:peeringService",
    "azure-nextgen:portal/latest:dashboard",
    "azure-nextgen:powerbi/latest:privateLinkServicesForPowerB",
    "azure-nextgen:powerbi/latest:tenant",
    "azure-nextgen:powerbi/latest:workspaceCollection",
    "azure-nextgen:powerbidedicated/latest:capacitie",
    "azure-nextgen:projectbabylon/latest:account",
    "azure-nextgen:providerhub/latest:rollout",
    "azure-nextgen:quantum/latest:Workspace",
    "azure-nextgen:recoveryservices/latest:vault",
    "azure-nextgen:redhatopenshift/latest:OpenShiftCluster",
    "azure-nextgen:relay/latest:namespace",
    "azure-nextgen:resourcegraph/latest:querie",
    "azure-nextgen:resources/latest:deployment",
    "azure-nextgen:resources/latest:deploymentScript",
    "azure-nextgen:resources/latest:resourceGroup",
    "azure-nextgen:resources/latest:subscription",
    "azure-nextgen:resources/latest:templateSpec",
    "azure-nextgen:resources/latest:templateSpecs/version",
    "azure-nextgen:saas/latest:application",
    "azure-nextgen:scvmm/latest:cloud",
    "azure-nextgen:scvmm/latest:VirtualMachine",
    "azure-nextgen:scvmm/latest:VirtualMachineTemplate",
    "azure-nextgen:scvmm/latest:VirtualNetwork",
    "azure-nextgen:scvmm/latest:vmmserver",
    "azure-nextgen:search/latest:searchService",
    "azure-nextgen:security/latest:automation",
    "azure-nextgen:security/latest:iotSecuritySolution",
    "azure-nextgen:servicebus/latest:namespace",
    "azure-nextgen:servicefabric/latest:application",
    "azure-nextgen:servicefabric/latest:cluster",
    "azure-nextgen:servicefabric/latest:containerGroup",
    "azure-nextgen:servicefabric/latest:containerGroupSet",
    "azure-nextgen:servicefabric/latest:edgecluster",
    "azure-nextgen:servicefabric/latest:managedcluster",
    "azure-nextgen:servicefabric/latest:network",
    "azure-nextgen:servicefabric/latest:secretstore",
    "azure-nextgen:servicefabric/latest:volume",
    "azure-nextgen:servicefabricmesh/latest:application",
    "azure-nextgen:servicefabricmesh/latest:containerGroup",
    "azure-nextgen:servicefabricmesh/latest:gateway",
    "azure-nextgen:servicefabricmesh/latest:network",
    "azure-nextgen:servicefabricmesh/latest:secret",
    "azure-nextgen:servicefabricmesh/latest:volume",
    "azure-nextgen:services/latest:rollout",
    "azure-nextgen:signalrservice/latest:Signal",
    "azure-nextgen:solutions/latest:applicationDefinition",
    "azure-nextgen:solutions/latest:application",
    "azure-nextgen:solutions/latest:jitRequest",
    "azure-nextgen:sql/latest:managedInstance",
    "azure-nextgen:sql/latest:managedInstances/database",
    "azure-nextgen:sql/latest:server",
    "azure-nextgen:sql/latest:database",
    "azure-nextgen:sqlvirtualmachine/latest:SqlVirtualMachineGroup",
    "azure-nextgen:sqlvirtualmachine/latest:SqlVirtualMachine",
    "azure-nextgen:storage/latest:storageAccount",
    "azure-nextgen:storagecache/latest:cache",
    "azure-nextgen:storagesync/latest:storageSyncService",
    "azure-nextgen:storagesyncdev/latest:storageSyncService",
    "azure-nextgen:storagesyncint/latest:storageSyncService",
    "azure-nextgen:storsimple/latest:manager",
    "azure-nextgen:streamanalytics/latest:cluster",
    "azure-nextgen:streamanalytics/latest:streamingjob",
    "azure-nextgen:synapse/latest:privateLinkHub",
    "azure-nextgen:synapse/latest:workspace",
    "azure-nextgen:synapse/latest:bigDataPool",
    "azure-nextgen:synapse/latest:sqlDatabase",
    "azure-nextgen:synapse/latest:sqlPool",
    "azure-nextgen:timeseriesinsights/latest:environment",
    "azure-nextgen:timeseriesinsights/latest:environments/eventsource",
    "azure-nextgen:timeseriesinsights/latest:environments/referenceDataSet",
    "azure-nextgen:token/latest:store",
    "azure-nextgen:virtualmachineimages/latest:imageTemplate",
    "azure-nextgen:vmware/latest:ArcZone",
    "azure-nextgen:vmware/latest:ResourcePool",
    "azure-nextgen:vmware/latest:VCenter",
    "azure-nextgen:vmware/latest:VirtualMachine",
    "azure-nextgen:vmware/latest:VirtualMachineTemplate",
    "azure-nextgen:vmware/latest:VirtualNetwork",
    "azure-nextgen:vmwarecloudsimple/latest:dedicatedCloudNode",
    "azure-nextgen:vmwarecloudsimple/latest:dedicatedCloudService",
    "azure-nextgen:vmwarecloudsimple/latest:virtualMachine",
    "azure-nextgen:vnfmanager/latest:device",
    "azure-nextgen:vnfmanager/latest:vnf",
    "azure-nextgen:vsonline/latest:account",
    "azure-nextgen:vsonline/latest:plan",
    "azure-nextgen:web/latest:certificate",
    "azure-nextgen:web/latest:connectionGateway",
    "azure-nextgen:web/latest:connection",
    "azure-nextgen:web/latest:customApi",
    "azure-nextgen:web/latest:hostingEnvironment",
    "azure-nextgen:web/latest:kubeEnvironment",
    "azure-nextgen:web/latest:serverFarm",
    "azure-nextgen:web/latest:site",
    "azure-nextgen:web/latest:premieraddon",
    "azure-nextgen:web/latest:slot",
    "azure-nextgen:web/latest:staticSite",
    "azure-nextgen:windowsesu/latest:multipleActivationKey",
    "azure-nextgen:windowsiot/latest:DeviceService",
    "azure-nextgen:workloadbuilder/latest:workload",
];
